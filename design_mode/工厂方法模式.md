### 工厂方法模式

#### 1. 介绍

该模式定义了一个用于创建对象的接口，让子类决定实例化哪一个类。工厂方法使一个类的实例化延迟到其子类。工厂方法模式是对简单工厂模式的进一步抽象和升级，但绝不是替代。

#### 2.解决思想

主要解决接口选择的问题。

#### 3.工厂方法模式的结构

工厂方法模式的主要角色如下。

1. 抽象工厂（Abstract Factory）：提供了创建产品的接口，调用者通过它访问具体工厂的工厂方法 newProduct() 来创建产品。

2. 具体工厂（ConcreteFactory）：主要是实现抽象工厂中的抽象方法，完成具体产品的创建。

3. 抽象产品（Product）：定义了产品的规范，描述了产品的主要特性和功能。

4. 具体产品（ConcreteProduct）：实现了抽象产品角色所定义的接口，由具体工厂来创建，它同具体工厂之间一一对应。

   ![](C:\Users\Lenovo\Desktop\mg\3-1Q114135A2M3.gif)

   

#### 4.工厂方法模式的优点和缺点

优点：

- 用户只需要知道具体工厂的名称就可得到所要的产品，无须知道产品的具体创建过程。
- 灵活性增强，对于新产品的创建，只需多写一个相应的工厂类。
- 典型的解耦框架。高层模块只需要知道产品的抽象类，无须关心其他实现类，满足迪米特法则、依赖倒置原则和里氏替换原则。

缺点：

- 类的个数容易过多，增加复杂度
- 增加了系统的抽象性和理解难度
- 抽象产品只能生产一种产品，此弊端可使用抽象工厂模式解决。

#### 5.工厂方法模式的应用场景

当类的对象产生时，若出现下列情况：

1.需要复杂的流程

2.需要加载外部资源，如从网络、存储设备、数据库

3.有对象上限

4.可重复利用

建议使用工厂方法模式来实现一个工厂类。

#### 6.代码实现

```c#
namespace FactoryPattern
{
    class Program
    {
        static void Main(string[] args)
        {
            AbstractFactory1 Factory1 = new AbstractFactory1();
            AbstractFactory2 Factory2 = new AbstractFactory2();
            AbstractFactory3 Factory3 = new AbstractFactory3();
            Product product1= Factory1.newProduct();
            product1.showProduct();
            Product product2 = Factory2.newProduct();
            product2.showProduct();
            Product product3 = Factory3.newProduct();
            product3.showProduct();
            Console.ReadKey();
        }
    }
    //抽象产品类
    public abstract class Product
    {
        public abstract void showProduct(); 
    }
    //具体产品类
    class ProductA: Product
    {
        public override void showProduct()
        {
            Console.WriteLine("ProductA被生产。");
        }
    }
    class ProductB : Product
    {
        public override void showProduct()
        {
            Console.WriteLine("ProductB被生产。");
        }
    }
    class ProductC : Product
    {
        public override void showProduct()
        {
            Console.WriteLine("ProductC被生产。");
        }
    }
    //抽象工厂类
    class AbstractFactory
    {
        public Product newProduct;
    }
    //具体工厂类
    class AbstractFactory1: AbstractFactory
    {
        public Product newProduct()
        {
            Console.WriteLine("工厂1生产产品A");
            return new ProductA();
        }
    }
    class AbstractFactory2 : AbstractFactory
    {
        public Product newProduct()
        {
            Console.WriteLine("工厂2生产产品B");
            return new ProductB();
        }
    }
    class AbstractFactory3 : AbstractFactory
    {
        public Product newProduct()
        {
            Console.WriteLine("工厂3生产产品C");
            return new ProductC();
        }
    }

}
```

##### 运行结果

![](C:\Users\Lenovo\Desktop\mg\工厂方法模式.PNG)

